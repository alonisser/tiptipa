<!DOCTYPE html>
<html>
<head>
	<title>טיפה.לי - טיפת חלב ליד הבית</title>

	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<meta name="apple-mobile-web-app-capable" content="yes" />

	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">

	<link rel="stylesheet" href="leaflet-plugins/L.control.locate.css" />
	
	<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.css" />
	 <!--[if lte IE 8]>
    	 <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.ie.css" />
 	<![endif]-->

	
	<style type="text/css">
		body {
		    padding: 0;
		    margin: 0;
		}

		html, body, #map {
		    height: 100%;
		}
	</style>

</head>
<body>
	<div id="map"></div>

	<!-- script src="data/all_stations.js"></script -->
	<script src="data/milk.js"></script>
	<script src="http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.js"></script>
	<script src="leaflet-plugins/L.control.locate.js"></script>

	<script type="text/javascript">

		String.prototype.trim = String.prototype.trim || function trim() { return this.replace(/^\s\s*/, '').replace(/\s\s*$/, ''); };

		function onEachFeature(feature, layer) {
			p = feature.properties
			phone = p.phones.split(',')[0].trim();

			// phone = feature.properties.phone;
			marker_html=	'<div style="text-align: right">'
								+ '<b>' + p.city + '</b><br />'
								+ p.address + '<br />'
								+ '<a href="tel:' + phone + '">' + phone + '</a><br />'
								+ 'יום א ' + (typeof p.days[0] != 'undefined' ? p.days[0] : 'סגור') +'<br />'
								+ 'יום ב ' + (typeof p.days[1] != 'undefined' ? p.days[1] : 'סגור') +'<br />'
								+ 'יום ג ' + (typeof p.days[2] != 'undefined' ? p.days[2] : 'סגור') +'<br />'
								+ 'יום ד ' + (typeof p.days[3] != 'undefined' ? p.days[3] : 'סגור') +'<br />'
								+ 'יום ה ' + (typeof p.days[4] != 'undefined' ? p.days[4] : 'סגור') +'<br />'
								+ 'יום ו ' + (typeof p.days[5] != 'undefined' ? p.days[5] : 'סגור')
							+ '</div>';

			layer.bindPopup(marker_html);
		}

		
		var MAP_CENTER = [31.87, 35.00];
		var DEFAULT_ZOOM = 11;
		
		var map = L.map('map', { scrollWheelZoom: true }).setView(MAP_CENTER, DEFAULT_ZOOM);

		map.locate({setView : true, maxZoom: 13});

		tile_url = 'http://{s}.tiles.mapbox.com/v3/niryariv.map-n3zuwkkz/{z}/{x}/{y}.png';
		L.tileLayer(tile_url, {
			attribution: '<a href="https://github.com/niryariv/tiptipa">קוד</a> | <a href="http://niryariv.wordpress.com/">ניר יריב</a> - <a href="http://degeladom.wordpress.com/">אלון ניסר</a> - שרון מורבי - <a href="http://gizra.com/">גיזרה</a> - <a href="http://www.hasadna.org.il/">הסדנא</a>',
			maxZoom: 16,
			minZoom: 9
		}).addTo(map);

		L.geoJson(stations,
			{
				filter: function(feature, layer) {
			        return !feature.properties.error;
			    },
				onEachFeature: onEachFeature,
			}
		).addTo(map);

		// disabling since the icon appears uncentered in iPhone
		// L.control.locate({
		// 	position: 'topright',
		// 	onLocationError: function(err) {}
		// }).addTo(map);
	</script>

	<script>
	  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	  ga('create', 'UA-43602637-1', 'tipa.li');
	  ga('send', 'pageview');

	</script>
</body>
</html>
<!- Jerusalem, summer 2013 -->